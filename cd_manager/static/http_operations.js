export function httpGet(endpoint_name, variable_context, response_handler, token) {
    let xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            response_handler(this.responseText);
        }
    };
    let endpoint = "http://" + location.hostname + ":8080/" + endpoint_name;
    xmlHttp.open("GET", endpoint, true);
    if (token) {
        xmlHttp.setRequestHeader('Authorization', 'Bearer ' + token);
    }
    xmlHttp.send(null);
}

export function httpPost(endpoint_name, data, variable_context, response_handler, token, data_type="json") {
    let xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            response_handler(this.responseText);
        }
    };
    let endpoint = "http://" + location.hostname + ":8080/" + endpoint_name;
    xmlHttp.open("POST", endpoint, true);
    if (data_type == "json") {
        xmlHttp.setRequestHeader('Content-type', 'application/json');
        // if (data_type == "form_data")
        //        xmlHttp.setRequestHeader('Content-type', 'multipart/form-data');
        // browser choose it by itself
    }
    if (token) {
        xmlHttp.setRequestHeader('Authorization', 'Bearer ' + token);
    }
    xmlHttp.send(data);
}

export function httpPostFetch(endpoint_name, data, variable_context, response_handler, token, data_type="json") {
    let endpoint = "http://" + location.hostname + ":8080/" + endpoint_name;
    let content_type = "text/html";
    let header = {
        Accept: "application/json",
        Authorization: 'Bearer ' + token,
        "User-Agent": "any-name"
    };
    if (data_type == "json") {
        header["Content-Type"] = "application/json";
    } else if (data_type == "form_data") {
        // generated by browser
    } else {
        header["Content-Type"] = content_type;
    }
    fetch(endpoint, {
        method: "POST",
        body: data,
        headers: header
    })
        .then(response => {
            if (!response.ok) {
                return Promise.reject(response);
            }
            return response.text();
        })
        .then(text => {
            response_handler(text);
        })
        .catch(error => {
            // TODO add error handling function here
            console.log("Fetch error " + variable_context);
            console.log(error);
        });
}
